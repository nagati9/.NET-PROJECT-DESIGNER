 @model ANA_ProjectDesigner.Models.Domain.Project
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Votre Page</title>
    <style>
        body {
            background-color: #ECE0E0;
            color: black;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .main-container {
            display: flex;
            flex-direction: row; /* Modification de l'orientation à l'horizontale */
        }

        .container {
            margin: 5px;
            padding: 10px;
        }

        .container1 {
            flex: 0.6;
            width: 100%; /* Agrandir la taille du select pour remplir le conteneur */
            background: transparent; /* Rendre le fond du select transparent */
            font-size: 16px;
        }

        .container2 {
            flex: 0.3;
            display: flex;
            flex-direction: column;
        }

        .container3 {
            flex: 0.4;
            background-color: #3D3939;
            color: white;
            text-align: center;
            padding: 10px;
        }

        .navigation-container {
            /* Nouvelle div qui encapsule les divs de la barre de navigation et la table */
            display: flex;
            flex-direction: column; /* Orientation verticale */
            width: 100%;
        }

        .navigation-bar {
            color: #3D3939;
            display: flex;
        }


        .tab {
            cursor: pointer;
            padding: 10px 20px; /* Espacement de 20px entre les onglets */
            color: 3D3939; /* Couleur par défaut des onglets */
            background-color: transparent; /* Fond transparent par défaut */
            transition: background-color 0.3s; /* Ajout d'une transition pour une animation douce */
            margin-left:1px;
        }

            .tab:hover {
                background-color: #3D3939; /* Couleur de fond gris lors du survol */
                color: white;
            }

        .selected-tab {
            color:white;
            background-color: #3D3939; /* Couleur de fond des onglets sélectionnés */
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        select {
            font-size: 32px;
            background:transparent;
            border: transparent;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #3D3939;
            color: white;
        }

        /* Style ajouté aux boutons */
        .container2 button {
            background-color: red;
            color: white;
            height: 5vh;
            margin-bottom: 10px; /* Espacement entre les boutons */
            cursor: pointer; /* Curseur indiquant que le bouton est cliquable */
        }

        /* Style pour la pop-up */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #1E1E1E;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

            .popup h2 {
                color: white;
                font-size: 20px;
                margin-bottom: 20px;
            }

            .popup button {
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
            }

            .popup button:hover {
                    background-color: #45a049;
                }

        .form-group {
            margin-bottom: 15px;
        }

        .form-groupbis {
            margin-bottom: 15px;
            display:flex;
            justify-content: space-between
        }

            .form-groupbis label {
            display: block;
            margin-bottom: 5px;
            text-align: left;
            color: white;
        }

            .form-groupbis input,
            .form-groupbis textarea {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            background: #d9d9d969;
        }

        

            .form-group label {
                display: block;
                margin-bottom: 5px;
                text-align: left;
                color: white;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 10px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 5px;
                background: #d9d9d969;
                font-size: 14px;
            }

            .form-group textarea {
                resize: vertical;
            }

        /* Style pour l'arrière-plan obscurci de la pop-up */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 999;
        }

        .table-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .sprint-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

            .sprint-table th, .sprint-table td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
                color:white;
            }

        .select-checkbox {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Groupe de conteneurs enfants 1, 2, et 3 -->
        <div class="container container1">
            <form id="projectForm" asp-controller="Project" asp-action="ProjectDetail" method="post">
                <input type="hidden" id="selectedProjectId" name="Id" value="@ViewBag.projectId" />
                <!-- Premier container -->
                <select name="selectedProject" onchange="updateProjectIdSelected(this)">
                    <option value="@ViewBag.projectId">@Model.Name</option>
                    @foreach (var project in @ViewBag.listProject)
                    {
                        <option value="@project.Id">@project.Name</option>
                    }
                </select>
            </form>
        </div>

        <div class="container container2">
            <!-- Deuxième container -->
            <button onclick="openPopup('Add')">Add Sprint</button>
            <button onclick="openPopup('Delete')">Delete sprint</button>
            <button onclick="openPopup('Edit')">Edit sprint</button>
        </div>

        <div class="container container3">
            <!-- Troisième container -->
            <p>Date du jour</p>
            <p>Numéro du sprint</p>
        </div>
    </div>

    <!-- Groupe de la barre de navigation et de la table -->
    <div class="navigation-container">
        <!-- Barre de navigation -->
        <div class="navigation-bar">
            <div class="tab sprints selected-tab" onclick="changeList('Sprints')">Sprints</div>
            <div class="tab tasks" onclick="changeList('Tasks')">Tasks</div>
            <div class="tab backlog" onclick="changeList('Backlog')">Backlog</div>
        </div>

        <!-- Tableau -->
        <table id="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les lignes du tableau seront ajoutées dynamiquement via JavaScript ou Razor en fonction de l'onglet sélectionné -->
                @foreach (var sprint in @ViewBag.listSprints)
                {
                    <tr>
                        <td>@sprint.SprintName</td>
                        <td>@sprint.DateStart.ToString("yyyy-MM-dd")</td>
                        <td>@sprint.DateEnd.ToString("yyyy-MM-dd")</td>
                        <td>@sprint.Comments</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Div pour la pop-up -->
    <div class="popup" id="popup">
        <h2>Ajouter un sprint</h2>
        <form asp-action="Add" asp-controller="Sprint" method="post">

            <input type="hidden" id="ProjectId" name="ProjectId" value="@ViewBag.projectId">

            <div class="form-group">
                <label for="sprintName">Sprint Name</label>
                <input type="text" id="sprintName" name="sprintName">
            </div>

            <div class="form-groupbis">
                <div>
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" name="DateStart" asp-format="{0:yyyy-MM-dd}">
                </div>
                <div>
                    <label for="endDate" style="margin-left: 15px;">End Date</label>
                    <input type="date" id="endDate" name="DateEnd" asp-format="{0:yyyy-MM-dd}">
                </div>
            </div>

            <div class="form-group">
                <label for="comments">Comments</label>
                <textarea id="comments" name="comments"></textarea>
            </div>

            <button type="submit" onclick="saveSprint()">Enregistrer</button>
        </form>
    </div>

    <!-- Div pour la pop-up -->
    <div class="popup" id="popupDelete">
        <h2>Delete a sprint</h2>
        <form asp-action="DeleteSprint" asp-controller="Sprint" method="post" onsubmit="return prepareDeleteForm()">
            <input type="hidden" id="ProjectId" name="ProjectId" value="@ViewBag.projectId">
            <div class="table-container">
                <table class="sprint-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Sprint Name</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sprint in @ViewBag.listSprints)
                        {
                            <tr>
                                <td>
                                    <input type="checkbox" class="select-checkbox" data-sprint-number="@sprint.SprintId" onchange="updateDeleteButtonState()" />
                                </td>
                                <td>@sprint.SprintName</td>
                                <td>@sprint.DateStart.ToString("yyyy-MM-dd")</td>
                                <td>@sprint.DateEnd.ToString("yyyy-MM-dd")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <input type="hidden" id="SprintIdToDelete" name="SprintId" value="">
            <button type="submit" id="deleteButton" onclick="saveSprint()" disabled>Supprimer</button>
        </form>
    </div>

    <!-- Div pour l'arrière-plan obscurci de la pop-up -->
    <div class="overlay" id="overlay" onclick="closePopup()"></div>

    <script>
        // Fonction pour retourner l'ID du project selectionné
        function updateProjectIdSelected(select) {
            var selectedValue = select.value;
            console.log(selectedValue);
            document.getElementById('selectedProjectId').value = selectedValue;
            document.getElementById('projectForm').submit();
            window.location.href = '/Project/ProjectDetail?projectId=' + selectedValue;
        }

        // Fonction pour ouvrir la pop-up
        function openPopup(content) {
            document.getElementById('overlay').style.display = 'block';
            switch (content) {
                case 'Add':
                    document.getElementById('popup').style.display = 'block';
                    break;
                case 'Delete':
                    document.getElementById('popupDelete').style.display = 'block';
                    break;
                case 'Papayas':
                    document.getElementById('popupEdit').style.display = 'block';
                    break;
                default:
                    console.log(`Content not found`);
            }
        }

        // Fonction pour fermer la pop-up
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('popupDelete').style.display = 'none';
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function saveSprint() {
            closePopup();
        }

        // Fonction pour changer la liste en fonction de l'onglet cliqué
        function changeList(tab) {
            // Réinitialiser la couleur de tous les onglets
            var tabs = document.querySelectorAll('.tab');
            tabs.forEach(function (t) {
                t.classList.remove('selected-tab');
            });

            // Appliquer la classe de sélection à l'onglet cliqué
            var selectedTab = document.querySelector('.tab.' + tab.toLowerCase());
            selectedTab.classList.add('selected-tab');

        }

        // Fonction pour activer/désactiver le bouton en fonction de la sélection des checkboxes
        function updateDeleteButtonState() {
            var checkboxes = document.querySelectorAll('.select-checkbox');
            var deleteButton = document.getElementById('deleteButton');

            var atLeastOneCheckboxSelected = false;
            var moreThanOneCheckboxSelected = false;

            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    if (atLeastOneCheckboxSelected) {
                        moreThanOneCheckboxSelected = true;
                    } else {
                        atLeastOneCheckboxSelected = true;
                    }
                }
            });

            deleteButton.disabled = !atLeastOneCheckboxSelected || moreThanOneCheckboxSelected;
        }

        function prepareDeleteForm() {
            var checkboxes = document.querySelectorAll('.select-checkbox:checked');
            var sprintIdInput = document.getElementById('SprintIdToDelete');

            if (checkboxes.length === 1) {
                sprintIdInput.value = checkboxes[0].getAttribute('data-sprint-number');
                return true; // Continuer avec la soumission du formulaire
            } else {
                alert("Please select exactly one sprint to delete.");
                return false; // Annuler la soumission du formulaire
            }
        }
    </script>


</body>
</html>
